# Description

Nmap (Network Mapper) is a utility for network discovery and security auditing.

# Command Syntax

## One Liners

Script to run a port scan, vuln scan and service + version scan.

```bash
nmap -p- -Pn $target -v --min-rate 1000 --max-rtt-timeout 1000ms --max-retries 5 -oN nmap_ports.txt && sleep 5 && nmap -Pn $target -sV -sC -v -oN nmap_sVsC.txt && sleep 5 && nmap -T5 -Pn $target -v --script vuln -oN nmap_vuln
```

FTP script scan for vulns, anon logins, etc

```bash
nmap --script ftp-anon,ftp-bounce,ftp-libopie,ftp-proftpd-backdoor,ftp-vsftpd-backdoor,ftp-vuln-cve2010-4221,tftp-enum -p 21 [IP]
```

## OS, Version, Script, Traceroute

```bash
nmap -A $target -oN nmap.out
```

## SYN, UDP All Ports Scan

```bash
nmap -p- -sS -sU --min-rate=1000 --max-retries=1 -T4 $target
```

## Fast Scans

```bash
# TCP Only
nmap -p- -T4 -n -Pn $target -oN [machine_name]_ports.txt

# Increased Min-Rate
sudo nmap --minrate-5000 -p- -vvv -Pn -n -oG openPorts.txt [IP]
```

## Powershell Functions

```powershell
# Check one port
Test-NetConnection -Port [portNumber] [IP]

# Check a range of ports
1..1024 % {echo ((New-Object Net.Sockets.TcpClient).Connect("[IP]", $_)) "TCP port $_ is open"} 2>$null
```

# Common Flags / Options

| Code                                                                                    | Explanation                                                                                                                                                                                                                                                               |
| --------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `nmap [scan types] [options] [target ip]`                                               | the scan types and options are basically flags that go towards scanning the target ip                                                                                                                                                                                     |
| `sudo nmap 10.129.2.0/24 -sn -oA tnet \| grep for \| cut -d" " -f5`                     | Scan the network range from  0 - 24, -sn disables port scanning, and -oA writes results in all formats to a file called tnet.<br><br>Then you grep for the word "for", and cut out the 5 words that are delimited with spaces<br><br>[[#Host Discovery]]<br>[[#Scan IPs]] |
| `sudo nmap -sn -oA tnet -iL hosts.lst`                                                  | `-iL` lets nmap scan through the list called `hosts.lst`.<br><br>[[#Scan IP List]]                                                                                                                                                                                        |
| 1.  `-p 22,25,28,80,139`<br>2. `-p 20-80`<br>3. `--top-ports=10`<br>4. `-F`<br>5. `-p-` | 1. List of ports<br>2. Range of ports<br>3. Top 10 ports<br>4. Fast scan \| top 100 ports<br>5. All ports<br><br>Refer to:<br>[[#Discover Open TCP Ports]]<br>[[#Host and Port Scanning]]                                                                                 |
| 1. `-oN`<br>2. `-oG`<br>3. `-oX`                                                        | 1. normal output `.nmap` extension<br>2. greppable outpot `.gnmap` extension<br>3. xml extension                                                                                                                                                                          |
| `-D RND:[int value]`                                                                    | `-D` is the Decoy Flag, and `RND:[value]` means Random value of ip addresses generated by Nmap, and our real one will be hidden in the middle of it somewhere.<br><br>[[#Decoys]]                                                                                         |
| `sudo nmap 10.129.2.28 -n -Pn -p 445 -O -S 10.129.2.200 -e tun0`                        | `-S` is to scan from a different source.<br>`-e tun0` is to pipe everything through that particular interface.<br>`-O` operation system scan                                                                                                                              |

# Use Cases

When and why you would use this technique?

# Examples

Practical example from a lab machine or HTB.

https://nmap.org/book/man-examples.html

# Related Notes

[MOC - Reconnaissance](../0%20-%20MOCs/MOC%20-%20Reconnaissance.md)

# References

https://nmap.org/book/man.html

# Resources

[Station X Nmap Cheatsheet](https://www.stationx.net/nmap-cheat-sheet/)

https://hackertarget.com/nmap-cheatsheet-a-quick-reference-guide/